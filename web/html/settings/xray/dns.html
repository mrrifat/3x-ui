{{define "settings/xray/dns"}}
<a-collapse default-active-key="1">
    <a-collapse-panel key="1" header='{{ i18n "pages.xray.generalConfigs"}}'>
        <a-setting-list-item paddings="small">
            <template #title>{{ i18n "pages.xray.dns.enable" }}</template>
            <template #description>{{ i18n "pages.xray.dns.enableDesc" }}</template>
            <template #control>
                <a-switch v-model="enableDNS"></a-switch>
            </template>
        </a-setting-list-item>
        <template v-if="enableDNS">
            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.tag" }}</template>
                <template #description>{{ i18n "pages.xray.dns.tagDesc" }}</template>
                <template #control>
                    <a-input type="text" v-model="dnsTag"></a-input>
                </template>
            </a-setting-list-item>
            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.clientIp" }}</template>
                <template #description>{{ i18n "pages.xray.dns.clientIpDesc" }}</template>
                <template #control>
                    <a-input type="text" v-model="dnsClientIp"></a-input>
                </template>
            </a-setting-list-item>
            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.strategy" }}</template>
                <template #description>{{ i18n "pages.xray.dns.strategyDesc" }}</template>
                <template #control>
                    <a-select v-model="dnsStrategy" :style="{ width: '100%' }"
                        :dropdown-class-name="themeSwitcher.currentTheme">
                        <a-select-option :value="l" :label="l" v-for="l in ['UseSystem', 'UseIP', 'UseIPv4', 'UseIPv6']">
                            <span>[[ l ]]</span>
                        </a-select-option>
                    </a-select>
                </template>
            </a-setting-list-item>
            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.disableCache" }}</template>
                <template #description>{{ i18n "pages.xray.dns.disableCacheDesc" }}</template>
                <template #control>
                    <a-switch v-model="dnsDisableCache"></a-switch>
                </template>
            </a-setting-list-item>
            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.disableFallback" }}</template>
                <template #description>{{ i18n "pages.xray.dns.disableFallbackDesc" }}</template>
                <template #control>
                    <a-switch v-model="dnsDisableFallback"></a-switch>
                </template>
            </a-setting-list-item>
            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.disableFallbackIfMatch" }}</template>
                <template #description>{{ i18n "pages.xray.dns.disableFallbackIfMatchDesc" }}</template>
                <template #control>
                    <a-switch v-model="dnsDisableFallbackIfMatch"></a-switch>
                </template>
            </a-setting-list-item>
            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.enableParallelQuery" }}</template>
                <template #description>{{ i18n "pages.xray.dns.enableParallelQueryDesc" }}</template>
                <template #control>
                    <a-switch v-model="dnsEnableParallelQuery"></a-switch>
                </template>
            </a-setting-list-item>

            <a-setting-list-item paddings="small">
                <template #title>{{ i18n "pages.xray.dns.useSystemHosts" }}</template>
                <template #description>{{ i18n "pages.xray.dns.useSystemHostsDesc" }}</template>
                <template #control>
                    <a-switch v-model="dnsUseSystemHosts"></a-switch>
                </template>
            </a-setting-list-item>
        </template>
    </a-collapse-panel>
    <template v-if="enableDNS">
        <a-collapse-panel key="dns-provider" header='DNS Provider Selector'>
            <a-space direction="vertical" size="large" :style="{ width: '100%' }">
                <a-row :gutter="16">
                    <a-col :xs="24" :sm="24" :md="16">
                        <a-card :title="'Select DNS Provider'" :bordered="true" size="small">
                            <a-select v-model="selectedDnsProvider" :style="{ width: '100%' }" 
                                :dropdown-class-name="themeSwitcher.currentTheme"
                                placeholder="Choose a DNS provider">
                                <a-select-option v-for="(preset, key) in dnsProviderPresets" :key="key" :value="key">
                                    <a-icon :type="getDnsIcon(preset.type)"></a-icon>
                                    <span :style="{ marginLeft: '8px' }">[[ preset.name ]]</span>
                                </a-select-option>
                            </a-select>
                            <a-space :style="{ marginTop: '12px', width: '100%' }" direction="horizontal">
                                <a-button type="primary" icon="check" @click="applyDnsProvider">
                                    Apply
                                </a-button>
                                <a-button type="default" icon="experiment" @click="testDnsProvider">
                                    Test
                                </a-button>
                            </a-space>
                        </a-card>
                    </a-col>
                    <a-col :xs="24" :sm="24" :md="8">
                        <a-card :title="'Provider Information'" :bordered="true" size="small" v-if="dnsProviderPresets[selectedDnsProvider]">
                            <a-space direction="vertical" size="small" :style="{ width: '100%' }">
                                <div>
                                    <a-tag :color="dnsProviderPresets[selectedDnsProvider].type === 'DoH' ? 'blue' : 
                                                   dnsProviderPresets[selectedDnsProvider].type === 'DoT' ? 'green' : 
                                                   dnsProviderPresets[selectedDnsProvider].type === 'Hybrid' ? 'purple' :
                                                   dnsProviderPresets[selectedDnsProvider].type === 'Traditional' ? 'orange' : 'default'">
                                        [[ dnsProviderPresets[selectedDnsProvider].type ]]
                                    </a-tag>
                                </div>
                                <a-typography-text type="secondary" :style="{ fontSize: '13px' }">
                                    [[ dnsProviderPresets[selectedDnsProvider].description ]]
                                </a-typography-text>
                                <a-divider :style="{ margin: '8px 0' }"></a-divider>
                                <div v-if="dnsProviderPresets[selectedDnsProvider].servers.length > 0">
                                    <a-typography-text strong :style="{ fontSize: '12px' }">DNS Servers:</a-typography-text>
                                    <ul :style="{ paddingLeft: '20px', margin: '4px 0', fontSize: '12px' }">
                                        <li v-for="(server, idx) in dnsProviderPresets[selectedDnsProvider].servers.slice(0, 3)" :key="idx">
                                            <span v-if="typeof server === 'object'">[[ server.address ]]</span>
                                            <span v-else>[[ server ]]</span>
                                        </li>
                                        <li v-if="dnsProviderPresets[selectedDnsProvider].servers.length > 3">
                                            ... and [[ dnsProviderPresets[selectedDnsProvider].servers.length - 3 ]] more
                                        </li>
                                    </ul>
                                </div>
                            </a-space>
                        </a-card>
                    </a-col>
                </a-row>
            </a-space>
        </a-collapse-panel>
        <a-collapse-panel key="2" header='DNS'>
            <template v-if="dnsServers.length > 0">
                <a-space direction="vertical" size="middle">
                    <a-button type="primary" icon="plus" @click="addDNSServer()">
                        <span>{{ i18n "pages.xray.dns.add" }}</span>
                    </a-button>
                    <a-table :columns="dnsColumns" bordered :row-key="r => r.key" :data-source="dnsServers"
                        :scroll="isMobile ? {} : { x: 200 }" :pagination="false" :indent-size="0"
                        :locale='{ filterConfirm: `{{ i18n "confirm" }}`, filterReset: `{{ i18n "reset" }}` }'>
                        <template slot="action" slot-scope="text,dns,index">
                            <span>[[ index+1 ]]</span>
                            <a-dropdown :trigger="['click']">
                                <a-icon @click="e => e.preventDefault()" type="more"
                                    :style="{ fontSize: '16px', textDecoration: 'bold' }"></a-icon>
                                <a-menu slot="overlay" :theme="themeSwitcher.currentTheme">
                                    <a-menu-item @click="editDNSServer(index)">
                                        <a-icon type="edit"></a-icon>
                                        <span>{{ i18n "edit" }}</span>
                                    </a-menu-item>
                                    <a-menu-item @click="deleteDNSServer(index)">
                                        <span :style="{ color: '#FF4D4F' }">
                                            <a-icon type="delete"></a-icon>
                                            <span>{{ i18n "delete"}}</span>
                                        </span>
                                    </a-menu-item>
                                </a-menu>
                            </a-dropdown>
                        </template>
                        <template slot="address" slot-scope="dns,index">
                            <span v-if="typeof dns == 'object'">[[ dns.address ]]</span>
                            <span v-else>[[ dns ]]</span>
                        </template>
                        <template slot="domain" slot-scope="dns,index">
                            <span v-if="typeof dns == 'object'">[[ dns.domains.join(",") ]]</span>
                        </template>
                        <template slot="expectIPs" slot-scope="dns,index">
                            <span v-if="typeof dns == 'object'">[[ dns.expectIPs.join(",") ]]</span>
                        </template>
                    </a-table>
                </a-space>
            </template>
            <template v-else>
                <a-empty description='{{ i18n "emptyDnsDesc" }}' :style="{ margin: '10px' }">
                    <a-button-group>
                        <a-button type="primary" icon="plus" @click="addDNSServer()">
                            <span>{{ i18n "pages.xray.dns.add" }}</span>
                        </a-button>
                        <a-button type="primary" icon="menu" @click="openDNSPresets()"></a-button>
                    </a-button-group>
                </a-empty>
            </template>
        </a-collapse-panel>
        <a-collapse-panel key="3" header='Fake DNS'>
            <template v-if="fakeDns && fakeDns.length > 0">
                <a-space direction="vertical" size="middle">
                    <a-button type="primary" icon="plus" @click="addFakedns()">{{ i18n "pages.xray.fakedns.add"
                        }}</a-button>
                    <a-table :columns="fakednsColumns" bordered :row-key="r => r.key" :data-source="fakeDns"
                        :scroll="isMobile ? {} : { x: 200 }" :pagination="false" :indent-size="0"
                        :locale='{ filterConfirm: `{{ i18n "confirm" }}`, filterReset: `{{ i18n "reset" }}` }'>
                        <template slot="action" slot-scope="text,fakedns,index">
                            <span>[[ index+1 ]]</span>
                            <a-dropdown :trigger="['click']">
                                <a-icon @click="e => e.preventDefault()" type="more"
                                    :style="{ fontSize: '16px', textDecoration: 'bold' }"></a-icon>
                                <a-menu slot="overlay" :theme="themeSwitcher.currentTheme">
                                    <a-menu-item @click="editFakedns(index)">
                                        <a-icon type="edit"></a-icon>
                                        <span>{{ i18n "edit" }}</span>
                                    </a-menu-item>
                                    <a-menu-item @click="deleteFakedns(index)">
                                        <span :style="{ color: '#FF4D4F' }">
                                            <a-icon type="delete"></a-icon>
                                            <span>{{ i18n "delete"}}</span>
                                        </span>
                                    </a-menu-item>
                                </a-menu>
                            </a-dropdown>
                        </template>
                    </a-table>
                </a-space>
            </template>
            <template v-else>
                <a-empty description='{{ i18n "emptyFakeDnsDesc" }}' :style="{ margin: '20px' }">
                    <a-button type="primary" icon="plus" @click="addFakedns()" :style="{ marginTop: '10px' }">
                        <span>{{ i18n "pages.xray.fakedns.add" }}</span>
                    </a-button>
                </a-empty>
            </template>
        </a-collapse-panel>
    </template>
</a-collapse>
{{end}}